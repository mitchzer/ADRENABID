<div class="container">

  <div class="row">

<div class="row-eq-height">

    <div class="col-xs-12 col-sm-6">
      <div class="auction-details">
        <% if @auction.status == 2 %>
        <h1>Auction completed</h1>
        <% if @auction.bids.count == 0 %>
        <p>No bids were placed on <%= @auction.product.name %>!</p>
        <% else %>
        <p><%= @auction.winning_user.username %> has won the auction</p>
        <p>He can buy the <%= @auction.product.name %> for <%= @auction.winning_bid.price %></p>
        <% end %>

        <% elsif @auction.status == 1 %>
        <h1><%= @auction.product.name %></h1>
        <p>Ongoing auction</p>
        <p>Recommended retail price of <%= humanized_money_with_symbol(@auction.product.recommended_retail_price) %></p>
        <p>Fee per bid: <%= humanized_money_with_symbol(@auction.fee_per_bid) %></p>
        <p>Price step: <%= humanized_money_with_symbol(@auction.price_step) %></p>
        <div>Auction ends in <span id="time"></span>!</div>

        <%= link_to "Back to auction list", auctions_path %>

        <% elsif @auction.status == 0 %>
        <p>Auction begins at <%= @auction.starting_time %></p>
        <% end %>
      </div>
    </div>

    <div class="col-xs-12 col-sm-6">
      <div class="bidding-form">
        <h1>Place your bid</h1>
        <div class="row status">
          <div class="row">
            <div class="col-xs-6 left">
              <p>My balance:</p>
            </div>
            <div class="col-xs-6 right">
              <p><%= humanized_money_with_symbol(current_user.wallet.balance) %></p>
            </div>
          </div>

          <div class="row">
            <div class="col-xs-6 left">
              <p>You can bid every:</p>
            </div>
            <div class="col-xs-6 right">
              <p><%= humanized_money_with_symbol(@auction.price_step) %></p>
            </div>
          </div>

          <div class="row">
            <div class="col-xs-6 left">
              <p>Price of one bid:</p>
            </div>
            <div class="col-xs-6 right">
              <p><%= humanized_money_with_symbol(@auction.fee_per_bid) %></p>
            </div>
          </div>

          <br>

          <div>
            <%= simple_form_for [ @auction, @bid ] do |f| %>
            <%= f.input :price_cents, placeholder: "Type your bidding price here in cents", label: false %>
            <%= f.submit "Bid !", class: "btn btn-primary" %>
            <% end %>
            <br>
          </div>
        </div>

      </div>
    </div>
    </div>
      </div>


    <div class="row">

      <% array = [] %>
      <% @auction.bids.sort_by { |b| b.price_cents }.each do |bid|  %>
      <% if bid.user == current_user %>
      <% array << humanized_money_with_symbol(bid.price) %>
      <% end %>
      <% end %>


      <% unless array.size == 0 %>
      <div class="currentbids">
        <div class="col-xs-12">
          <br>
          <br>

          <p>You have currently <%= array.size %> bids on this auction:</p>
        </div>
        <br>
        <br>
      </div>
      <div class="currentbids-prices">
        <% array.each do |price| %>
        <div class = "col-xs-6 col-md-2">
          <li><%= price %></li>
          <br>
        </div>
        <% end %>
      </div>
      <% else %>
      <div class="currentbids">
        <div class="col-xs-12">
          <p>You have not bidded here yet</p>
        </div>
      </div>
      <br>

      <% end %>
    </div>


  <script>
    function startTimer(duration, display) {
      var start = Date.now(),
      diff,
      minutes,
      seconds;
      function timer() {
          // get the number of seconds that have elapsed since
          // startTimer() was called
          diff = duration - (((Date.now() - start) / 1000) | 0);

          // does the same job as parseInt truncates the float
          minutes = (diff / 60) | 0;
          seconds = (diff % 60) | 0;
          hours = minutes / 60 | 0;
          days = hours / 24 | 0;


          minutes = minutes < 10 ? "0" + minutes : minutes;
          seconds = seconds < 10 ? "0" + seconds : seconds;

          display.textContent = days + " days " + (hours % 24) + " hours " + (minutes % 60) + " minutes and " + seconds + " seconds";

          if (diff <= 0) {
              // add one second so that the count down starts at the full duration
              // example 05:00 not 04:59
              window.location.reload(false);
            }
          };
      // we don't want to wait a full second before the timer starts
      timer();
      setInterval(timer, 1000);
    }

    window.onload = function () {
      var timeLeft = <%=@auction.ending_time - DateTime.now%>
      display = document.querySelector('#time');
      startTimer(timeLeft, display);
    };
  </script>
</div>


</div>


